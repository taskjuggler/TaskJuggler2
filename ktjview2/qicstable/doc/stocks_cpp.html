<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>stocks.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<a href="http://www.ics.com/index.html">
<img src="ics.jpg" border="0" alt="ICS">
</a>
<center>
<H2>QicsTable Documentation Set</H2>
</center>
</a></head><body>


<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1><a name="stocks_cpp">stocks.cpp</a>
</h1><div class="fragment"><pre><span class="comment">/****************************************************************************</span>
<span class="comment">** $RCSfile$ $Date$</span>
<span class="comment">**</span>
<span class="comment">** Copyright ( C ) 2002-2003 Integrated Computer Solutions, Inc.</span>
<span class="comment">** All rights reserved.</span>
<span class="comment">**</span>
<span class="comment">** This file is part of an example program for QicsTable.  This example</span>
<span class="comment">** program may be used, distributed and modified without limitation.</span>
<span class="comment">**</span>
<span class="comment">*****************************************************************************/</span>

<span class="preprocessor">#include &lt;qapplication.h&gt;</span>
<span class="preprocessor">#include &lt;qmainwindow.h&gt;</span>
<span class="preprocessor">#include &lt;qmenubar.h&gt;</span>
<span class="preprocessor">#include &lt;qlabel.h&gt;</span>
<span class="preprocessor">#include &lt;qpushbutton.h&gt;</span>
<span class="preprocessor">#include &lt;qcheckbox.h&gt;</span>
<span class="preprocessor">#include &lt;qfile.h&gt;</span>
<span class="preprocessor">#include &lt;qtimer.h&gt;</span>

<span class="preprocessor">#include &lt;QicsTable.h&gt;</span>
<span class="preprocessor">#include &lt;QicsDataModelDefault.h&gt;</span>
<span class="preprocessor">#include &lt;QicsComboCellDisplay.h&gt;</span>

<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;math.h&gt;</span>

<span class="preprocessor">#include "high.xpm"</span>
<span class="preprocessor">#include "low.xpm"</span>


<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> fname[] = <span class="stringliteral">"initial-values.txt"</span>;

<span class="keyword">static</span> <span class="keywordtype">int</span> stock_name = 0;
<span class="keyword">static</span> <span class="keywordtype">int</span> day_zero = 1;
<span class="keyword">static</span> <span class="keywordtype">int</span> day_one = 4;
<span class="keyword">static</span> <span class="keywordtype">int</span> day_two = 7;
<span class="keyword">static</span> <span class="keywordtype">int</span> day_three = 10;

<span class="keyword">static</span> <span class="keywordtype">int</span> cur_idx = 0;
<span class="keyword">static</span> <span class="keywordtype">int</span> high_idx = 1;
<span class="keyword">static</span> <span class="keywordtype">int</span> low_idx = 2;

<span class="keyword">static</span> <span class="keywordtype">int</span> nyse_idx = 0;
<span class="keyword">static</span> <span class="keywordtype">int</span> nasdaq_idx = 1;

<span class="keyword">static</span> <span class="keywordtype">int</span> update_period = 2000;

<span class="comment">//#define ADD_DATA</span>


<span class="keyword">class </span>StockData : <span class="keyword">public</span> QObject
{
    Q_OBJECT
<span class="keyword">public</span>:
    StockData();
    ~StockData();

    <a class="code" href="classQicsDataModel.html">QicsDataModel</a> *dataModel(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> myDM; }

<span class="keyword">public</span> slots:
    <span class="keywordtype">void</span> updateStocks(<span class="keywordtype">void</span>);

signals:
    <span class="keywordtype">void</span> stockChanged(<span class="keywordtype">int</span> row, <span class="keywordtype">bool</span> gained);

<span class="keyword">protected</span> slots:
    <span class="keywordtype">void</span> dataValuesChanged(<a class="code" href="classQicsRegion.html">QicsRegion</a> reg);

<span class="keyword">protected</span>:
    <span class="keywordtype">void</span> loadDT(<span class="keywordtype">void</span>);
    <span class="keywordtype">void</span> addDay(<span class="keywordtype">int</span> start_col);
    <span class="keywordtype">void</span> updateStock(<span class="keywordtype">int</span> row);

    <span class="keywordtype">float</span> getFloatValue(<span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col);
    <span class="keywordtype">float</span> newprice(<span class="keywordtype">float</span> old_price, <span class="keywordtype">float</span> percent_change = (<span class="keywordtype">float</span>) 0.02, <span class="keywordtype">int</span> updown = 1);
    <span class="keywordtype">int</span> roundf(<span class="keywordtype">float</span> f);
    <span class="keywordtype">float</span> randf(<span class="keywordtype">void</span>);
    <span class="keywordtype">int</span> posneg(<span class="keywordtype">void</span>);

    <a class="code" href="classQicsDataModel.html">QicsDataModel</a> *myDM;
};


StockData::StockData() :
    QObject()
{
    myDM = <span class="keyword">new</span> QicsDataModelDefault();

    connect(myDM, SIGNAL(modelChanged(<a class="code" href="classQicsRegion.html">QicsRegion</a>)),
        <span class="keyword">this</span>, SLOT(dataValuesChanged(<a class="code" href="classQicsRegion.html">QicsRegion</a>)));

    loadDT();
}

StockData::~StockData()
{
    <span class="keyword">delete</span> myDM;
}

<span class="keywordtype">void</span>
StockData::updateStocks(<span class="keywordtype">void</span>)
{
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= myDM-&gt;lastRow(); ++i)
    updateStock(i);
}

<span class="keywordtype">void</span>
StockData::loadDT(<span class="keywordtype">void</span>)
{
    QFile f(fname);
    f.open(IO_ReadOnly);

    QTextStream stream(&amp;f);
    
    myDM-&gt;readASCII(stream);

    f.close();

<span class="preprocessor">#ifdef ADD_DATA</span>
<span class="preprocessor"></span>    myDM-&gt;addColumns(6);
<span class="preprocessor">#if defined(Q_WS_WIN32)</span>
<span class="preprocessor"></span>    srand(2332);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    srandom(2332);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    addDay(day_two);
    addDay(day_three);
    QFile out(<span class="stringliteral">"out.txt"</span>);
    out.open(IO_WriteOnly);
    QTextStream outstream(&amp;out);

    myDM-&gt;writeASCII(outstream, <span class="charliteral">';'</span>);

    out.close();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}

<span class="keywordtype">void</span>
StockData::addDay(<span class="keywordtype">int</span> start_col)
{
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; myDM-&gt;numRows(); ++i)
    {
    <span class="keywordtype">float</span> old_price = getFloatValue(i, day_one+cur_idx);
    <span class="keywordtype">float</span> new_price = newprice(old_price, (<span class="keywordtype">float</span>) 0.05, posneg());

    <a class="code" href="classQicsDataFloat.html">QicsDataFloat</a> fdata(new_price);
    <a class="code" href="classQicsDataFloat.html">QicsDataFloat</a> high(newprice(new_price, (<span class="keywordtype">float</span>) 0.05, 1));
    <a class="code" href="classQicsDataFloat.html">QicsDataFloat</a> low(newprice(new_price, (<span class="keywordtype">float</span>) 0.05, -1));

    myDM-&gt;setItem(i, start_col+high_idx, high);
    myDM-&gt;setItem(i, start_col+low_idx, low);
    myDM-&gt;setItem(i, start_col+cur_idx, fdata);
    }
}


<span class="keywordtype">float</span>
StockData::getFloatValue(<span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col)
{
    <span class="keyword">const</span> <a class="code" href="classQicsDataItem.html">QicsDataItem</a> *itm = myDM-&gt;item(row, col);

    <span class="keywordflow">if</span> (itm)
    {
    <span class="keywordflow">if</span> (itm-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema5">type</a>() == QicsDataItem_Float)
        <span class="keywordflow">return</span> ((<a class="code" href="classQicsDataFloat.html">QicsDataFloat</a> *) itm)-&gt;data();
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itm-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema5">type</a>() == QicsDataItem_Double)
        <span class="keywordflow">return</span> ((<a class="code" href="classQicsDataDouble.html">QicsDataDouble</a> *) itm)-&gt;data();
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itm-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema5">type</a>() == QicsDataItem_Int)
        <span class="keywordflow">return</span> ((<a class="code" href="classQicsDataInt.html">QicsDataInt</a> *) itm)-&gt;data();
    }

    <span class="keywordflow">return</span> -1;
}

<span class="keywordtype">int</span>
StockData::roundf(<span class="keywordtype">float</span> f)
{
    <span class="keywordtype">int</span> base = (<span class="keywordtype">int</span>) floor(f);

    <span class="keywordflow">if</span> ((f - base) &lt; 0.5)
    <span class="keywordflow">return</span> base;
    <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> base + 1;
}

<span class="keywordtype">float</span>
StockData::randf(<span class="keywordtype">void</span>)
{
<span class="preprocessor">#if defined(Q_WS_WIN32)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> (<span class="keywordtype">float</span>) rand() / (<span class="keywordtype">float</span>) RAND_MAX;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> (<span class="keywordtype">float</span>) random() / (<span class="keywordtype">float</span>) RAND_MAX;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}

<span class="keywordtype">int</span>
StockData::posneg(<span class="keywordtype">void</span>)
{
    <span class="keywordflow">if</span> (roundf(randf()) &lt; 0.5)
    <span class="keywordflow">return</span> -1;
    <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> 1;
}

<span class="keywordtype">float</span>
StockData::newprice(<span class="keywordtype">float</span> old_price, <span class="keywordtype">float</span> percent_change, <span class="keywordtype">int</span> updown)
{
    <span class="keywordtype">float</span> new_price = old_price + (randf() * percent_change * old_price * updown);
    new_price = ((<span class="keywordtype">float</span>) (roundf(new_price * 100))) / 100;

    <span class="keywordflow">return</span> new_price;
}

<span class="keywordtype">void</span>
StockData::updateStock(<span class="keywordtype">int</span> row)
{
    <span class="keywordtype">float</span> cur_price;

    cur_price = getFloatValue(row, day_zero+cur_idx);
    <span class="keywordflow">if</span> (cur_price &lt; 0)
    <span class="comment">// yesterday's close</span>
    cur_price = getFloatValue(row, day_one+cur_idx);

    cur_price = newprice(cur_price, (<span class="keywordtype">float</span>) 0.02, posneg());
    <a class="code" href="classQicsDataFloat.html">QicsDataFloat</a> fdata(cur_price);
    myDM-&gt;setItem(row, day_zero+cur_idx, fdata);

    <span class="comment">// Check high</span>
    <span class="keywordtype">float</span> high = getFloatValue(row, day_zero+high_idx);
    <span class="keywordflow">if</span> ((high &lt; 0) || (cur_price &gt; high))
    myDM-&gt;setItem(row, day_zero+high_idx, fdata);

    <span class="comment">// Check low</span>
    <span class="keywordtype">float</span> low = getFloatValue(row, day_zero+low_idx);
    <span class="keywordflow">if</span> ((low &lt; 0) || (cur_price &lt; low))
    myDM-&gt;setItem(row, day_zero+low_idx, fdata);
}

<span class="keywordtype">void</span> 
StockData::dataValuesChanged(<a class="code" href="classQicsRegion.html">QicsRegion</a> reg)
{
    <span class="keywordtype">int</span> row = reg.<a class="code" href="classQicsRegion.html#QicsRegiona3">startCell</a>().row();
    <span class="keywordtype">int</span> col = reg.<a class="code" href="classQicsRegion.html#QicsRegiona3">startCell</a>().column();

    <span class="keywordflow">if</span> (col == day_zero+cur_idx)
    {
    <span class="keywordtype">float</span> yesterday = getFloatValue(row, day_one+cur_idx);
    <span class="keywordtype">float</span> today = getFloatValue(row, day_zero+cur_idx);

    emit stockChanged(row, (today &gt; yesterday));
    }
}


<span class="keyword">class </span>StockUI: <span class="keyword">public</span> QObject
{
    Q_OBJECT
<span class="keyword">public</span>:
    StockUI(<a class="code" href="classQicsDataModel.html">QicsDataModel</a> *dt);
    ~StockUI();

    <span class="keyword">inline</span> QWidget *base(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> myMainWindow; }
    <span class="keyword">inline</span> QicsTable *table(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> myTable; }

signals:
    <span class="keywordtype">void</span> updateToggled(<span class="keywordtype">bool</span> on);

<span class="keyword">protected</span> slots:
    <span class="keywordtype">void</span> decorateStock(<span class="keywordtype">int</span> idx, <span class="keywordtype">bool</span> gainer);

<span class="keyword">protected</span>:
    <span class="keywordtype">void</span> setupRowHeader(<span class="keywordtype">void</span>);
    <span class="keywordtype">void</span> setupColumnHeader(<span class="keywordtype">void</span>);
    <span class="keywordtype">void</span> setupGrid(<span class="keywordtype">void</span>);

    <span class="keywordtype">void</span> setupDay(<span class="keywordtype">int</span> day_idx, QString day);

    QMainWindow *myMainWindow;
    QicsTable *myTable;
};

StockUI::StockUI(<a class="code" href="classQicsDataModel.html">QicsDataModel</a> *dt) :
    QObject()
{
    myMainWindow = <span class="keyword">new</span> QMainWindow();
    
    myTable = <span class="keyword">new</span> QicsTable(dt, myMainWindow);
    myMainWindow-&gt;setCentralWidget(myTable);

    QMenuBar *menu = myMainWindow-&gt;menuBar();
    
    QPopupMenu *file = <span class="keyword">new</span> QPopupMenu(myMainWindow);
    file-&gt;insertItem(<span class="stringliteral">"E&amp;xit"</span>, qApp, SLOT(quit()));
    menu-&gt;insertItem(<span class="stringliteral">"&amp;File"</span>, file);

    QLabel *label = <span class="keyword">new</span> QLabel(QString(<span class="stringliteral">"Stock Activity"</span>), myTable);
    QFont fnt = label-&gt;font();
    fnt.setPointSize(fnt.pointSize() + 6);
    label-&gt;setFont(fnt);
    label-&gt;setAlignment(Qt::AlignCenter);
    myTable-&gt;setTopTitleWidget(label);

    setupRowHeader();
    setupColumnHeader();
    setupGrid();

    QCheckBox *cb = <span class="keyword">new</span> QCheckBox(QString(<span class="stringliteral">"Auto\nUpdates"</span>), myTable);
    myTable-&gt;setTopLeftCornerWidget(cb);
    connect(cb, SIGNAL(toggled(<span class="keywordtype">bool</span>)),
        <span class="keyword">this</span>, SIGNAL(updateToggled(<span class="keywordtype">bool</span>)));

    myMainWindow-&gt;show();
}

StockUI::~StockUI()
{
    <span class="keyword">delete</span> myTable;
}

<span class="keywordtype">void</span>
StockUI::setupRowHeader(<span class="keywordtype">void</span>)
{
    <span class="comment">// nothing to do here</span>
}

<span class="keywordtype">void</span>
StockUI::setupColumnHeader(<span class="keywordtype">void</span>)
{
    QicsColumnHeader *ch = myTable-&gt;columnHeader();

    ch-&gt;<a class="code" href="classQicsColumnHeader.html#QicsColumnHeaderi0">setNumRows</a>(3);

    ch-&gt;<a class="code" href="classQicsCellCommon.html#QicsTableCommoni52">setAlignment</a>(Qt::AlignCenter);

    <span class="comment">// Stock header</span>
    ch-&gt;<a class="code" href="classQicsGridCommon.html#QicsTableCommona64">addCellSpan</a>(<a class="code" href="classQicsSpan.html">QicsSpan</a>(0,stock_name, 3, 1));
    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,stock_name).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Stock"</span>));

    setupDay(day_zero, QString(<span class="stringliteral">"Today"</span>));
    setupDay(day_one, QString(<span class="stringliteral">"One Day Ago"</span>));
    setupDay(day_two, QString(<span class="stringliteral">"Two Days Ago"</span>));
    setupDay(day_three, QString(<span class="stringliteral">"Three Days Ago"</span>));

    <span class="keyword">delete</span> ch;
}

<span class="keywordtype">void</span>
StockUI::setupDay(<span class="keywordtype">int</span> day_idx, QString day)
{
    QicsColumnHeader *ch = myTable-&gt;columnHeader();

    ch-&gt;<a class="code" href="classQicsGridCommon.html#QicsTableCommona64">addCellSpan</a>(<a class="code" href="classQicsSpan.html">QicsSpan</a>(0,day_idx, 1, 3));
    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,day_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(day));

    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,day_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni44">setForegroundColor</a>(Qt::white);
    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,day_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni45">setBackgroundColor</a>(Qt::blue);

    ch-&gt;<a class="code" href="classQicsGridCommon.html#QicsTableCommona64">addCellSpan</a>(<a class="code" href="classQicsSpan.html">QicsSpan</a>(1,day_idx, 1, 2));
    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(1,day_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Show Gains in"</span>));

    ch-&gt;<a class="code" href="classQicsCellCommon.html#QicsRowHeadera58">dataModel</a>()-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModeli0">setItem</a>(1,day_idx+2, <a class="code" href="classQicsDataString.html">QicsDataString</a>(<span class="stringliteral">"Green"</span>));
    QicsComboCellDisplay *cd = <span class="keyword">new</span> QicsComboCellDisplay();
    cd-&gt;insertItem(QString(<span class="stringliteral">"Green"</span>));
    cd-&gt;insertItem(QString(<span class="stringliteral">"Red"</span>));
    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(1,day_idx+2).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni50">setDisplayer</a>(cd);

    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(2,day_idx+cur_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Current"</span>));

    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(2,day_idx+high_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"High"</span>));
    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(2,day_idx+high_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni48">setPixmap</a>(QPixmap(high_xpm));

    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(2,day_idx+low_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Low"</span>));
    ch-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(2,day_idx+low_idx).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni48">setPixmap</a>(QPixmap(low_xpm));

    <span class="keyword">delete</span> ch;
}

<span class="keywordtype">void</span>
StockUI::setupGrid(<span class="keywordtype">void</span>)
{
    QicsDataItemSprintfFormatter *v = <span class="keyword">new</span> QicsDataItemSprintfFormatter();

    myTable-&gt;columnRef(0).setWidthInChars(7);

    v-&gt;<a class="code" href="classQicsDataItemSprintfFormatter.html#QicsDataItemSprintfFormattera3">addFormatString</a>(QicsDataItem_Float, <span class="stringliteral">"$%.2f"</span>);
    v-&gt;<a class="code" href="classQicsDataItemSprintfFormatter.html#QicsDataItemSprintfFormattera3">addFormatString</a>(QicsDataItem_Int, <span class="stringliteral">"$%d.00"</span>);
    myTable-&gt;mainGridRef().setFormatter(v);

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = day_zero; i &lt;= (day_three + 2); ++i)
    {
    myTable-&gt;columnRef(i).setAlignment(Qt::AlignRight);
    }

    <span class="comment">// the NYSE and NASDAQ rows...</span>
    QFont fnt = myTable-&gt;font();
    fnt.setPointSize(fnt.pointSize() + 2);
    fnt.setBold(<span class="keyword">true</span>);
    myTable-&gt;rowRef(nyse_idx).setFont(fnt);
    myTable-&gt;rowRef(nasdaq_idx).setFont(fnt);

    v = <span class="keyword">new</span> QicsDataItemSprintfFormatter();
    v-&gt;<a class="code" href="classQicsDataItemSprintfFormatter.html#QicsDataItemSprintfFormattera3">addFormatString</a>(QicsDataItem_Float, <span class="stringliteral">"%.2f"</span>);
    v-&gt;<a class="code" href="classQicsDataItemSprintfFormatter.html#QicsDataItemSprintfFormattera3">addFormatString</a>(QicsDataItem_Int, <span class="stringliteral">"%d.00"</span>);
    myTable-&gt;rowRef(nyse_idx).setFormatter(v);
    myTable-&gt;rowRef(nasdaq_idx).setFormatter(v);

    myTable-&gt;freezeTopRows(2);
}

<span class="keywordtype">void</span> 
StockUI::decorateStock(<span class="keywordtype">int</span> idx, <span class="keywordtype">bool</span> gainer)
{
    <span class="keyword">const</span> <a class="code" href="classQicsDataItem.html">QicsDataItem</a> *itm =
    myTable-&gt;columnHeaderRef().cellRef(1, day_zero+2).dataValue();
    QString gain_color = itm-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema4">string</a>();

    QColor c;

    <span class="keywordflow">if</span> (gainer)
    c = QColor(gain_color);
    <span class="keywordflow">else</span>
    c = myTable-&gt;mainGridRef().foregroundColor();

    myTable-&gt;cellRef(idx, day_zero+cur_idx).setForegroundColor(c);
}


<span class="keyword">class </span>StockApp : <span class="keyword">public</span> QApplication
{
    Q_OBJECT
<span class="keyword">public</span>:
    StockApp(<span class="keywordtype">int</span> &amp;argc, <span class="keywordtype">char</span> **argv);
    ~StockApp();

<span class="keyword">protected</span> slots:
    <span class="keywordtype">void</span> toggleUpdates(<span class="keywordtype">bool</span> on);
    <span class="keywordtype">void</span> updateStocks(<span class="keywordtype">void</span>);

<span class="keyword">protected</span>:
    StockData *mySD;
    StockUI *myUI;
    QTimer *myTimer;

    <span class="keyword">static</span> <span class="keywordtype">int</span> SortFloats(<span class="keyword">const</span> <a class="code" href="classQicsDataItem.html">QicsDataItem</a> *a, <span class="keyword">const</span> <a class="code" href="classQicsDataItem.html">QicsDataItem</a> *b);
};

StockApp::StockApp(<span class="keywordtype">int</span> &amp;argc, <span class="keywordtype">char</span> **argv) :
    QApplication(argc, argv)
{
    mySD = <span class="keyword">new</span> StockData();
    myUI = <span class="keyword">new</span> StockUI(mySD-&gt;dataModel());
    
    setMainWidget(myUI-&gt;base());

    connect(myUI, SIGNAL(updateToggled(<span class="keywordtype">bool</span>)),
        <span class="keyword">this</span>, SLOT(toggleUpdates(<span class="keywordtype">bool</span>)));

    myTimer = <span class="keyword">new</span> QTimer();
    connect(myTimer, SIGNAL(timeout()),
        <span class="keyword">this</span>, SLOT(updateStocks()));

    connect(mySD, SIGNAL(stockChanged(<span class="keywordtype">int</span>, <span class="keywordtype">bool</span>)),
        myUI, SLOT(decorateStock(<span class="keywordtype">int</span>, <span class="keywordtype">bool</span>)));
}

StockApp::~StockApp()
{
    <span class="keyword">delete</span> mySD;
    <span class="keyword">delete</span> myUI;
    <span class="keyword">delete</span> myTimer;
}

<span class="keywordtype">void</span>
StockApp::toggleUpdates(<span class="keywordtype">bool</span> on)
{
    <span class="keywordflow">if</span> (on)
    myTimer-&gt;start(update_period);
    <span class="keywordflow">else</span>
    myTimer-&gt;stop();
}

<span class="keywordtype">void</span>
StockApp::updateStocks(<span class="keywordtype">void</span>)
{
    mySD-&gt;updateStocks();

    myUI-&gt;table()-&gt;sortRows(day_zero+cur_idx, Qics::Descending, 2, -1, &amp;SortFloats);
}

<span class="keywordtype">int</span>
StockApp::SortFloats(<span class="keyword">const</span> <a class="code" href="classQicsDataItem.html">QicsDataItem</a> *a, <span class="keyword">const</span> <a class="code" href="classQicsDataItem.html">QicsDataItem</a> *b)
{
    <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema5">type</a>() == QicsDataItem_Float) &amp;&amp;
    (b-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema5">type</a>() == QicsDataItem_Float))
    {
    <span class="keywordtype">float</span> fa = ((<span class="keyword">const</span> <a class="code" href="classQicsDataFloat.html">QicsDataFloat</a> *) a)-&gt;data();
    <span class="keywordtype">float</span> fb = ((<span class="keyword">const</span> <a class="code" href="classQicsDataFloat.html">QicsDataFloat</a> *) b)-&gt;data();

    <span class="keywordflow">if</span> (fa &lt; fb)
        <span class="keywordflow">return</span> -1;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fa == fb)
        <span class="keywordflow">return</span> 0;
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> 1;
    }
    <span class="keywordflow">else</span>
    {
    qDebug(<span class="stringliteral">"not floats"</span>);
        QString sa = a-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema4">string</a>();
        QString sb = b-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema4">string</a>();
        <span class="keywordflow">return</span> sa.compare(sb);
    }
}


<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
    StockApp app(argc,argv);

    <span class="keywordflow">return</span> app.exec();
}


<span class="preprocessor">#include "stocks.moc"</span>

</pre></div> <!-- footer -->
<P>
<center>
<font size="1">
All trademarks and copyrights on this page are properties of
their respective owners.<br> The rest is copyright ©1999-2003 Integrated
Computer Solutions, Inc.
</font>
</center>
<!-- end footer -->
