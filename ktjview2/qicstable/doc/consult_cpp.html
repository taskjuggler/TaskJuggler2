<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>consultant.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<a href="http://www.ics.com/index.html">
<img src="ics.jpg" border="0" alt="ICS">
</a>
<center>
<H2>QicsTable Documentation Set</H2>
</center>
</a></head><body>


<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1><a name="consult_cpp">consultant.cpp</a>
</h1><div class="fragment"><pre><span class="comment">/****************************************************************************</span>
<span class="comment">** $RCSfile$ $Date$</span>
<span class="comment">**</span>
<span class="comment">** Copyright ( C ) 2002-2003 Integrated Computer Solutions, Inc.</span>
<span class="comment">** All rights reserved.</span>
<span class="comment">**</span>
<span class="comment">** This file is part of an example program for QicsTable.  This example</span>
<span class="comment">** program may be used, distributed and modified without limitation.</span>
<span class="comment">**</span>
<span class="comment">*****************************************************************************/</span>

<span class="preprocessor">#include "consultant.h"</span>

<span class="preprocessor">#include &lt;qfiledialog.h&gt;</span>

<span class="preprocessor">#define NUM_COLUMNS 7</span>
<span class="preprocessor"></span>

<span class="comment">/*</span>
<span class="comment"> * SecCheckBox Methods</span>
<span class="comment"> */</span>

<span class="keywordtype">bool</span>
SecCheckBox::checkState(<a class="code" href="classQicsGridInfo.html">QicsGridInfo</a>* , <span class="keywordtype">int</span> , <span class="keywordtype">int</span> ,
                        <span class="keywordtype">int</span> , <span class="keywordtype">int</span> ,
                        <span class="keyword">const</span> <a class="code" href="classQicsDataItem.html">QicsDataItem</a>* itm)
{
    <span class="comment">// Returns the state of the cell, based on the data item.</span>
    <span class="comment">// State is false unless the data item is "y".</span>

    QString tableState = itm-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema4">string</a>();

    <span class="keywordflow">return</span> (tableState == <span class="stringliteral">"y"</span>);
}

<span class="keywordtype">void</span>
SecCheckBox::valueChanged(<a class="code" href="classQicsGridInfo.html">QicsGridInfo</a> *info, <span class="keywordtype">int</span> , <span class="keywordtype">int</span> ,
                          <span class="keywordtype">int</span> model_row, <span class="keywordtype">int</span> model_col, <span class="keywordtype">bool</span> set)
{
    QString val;

    <span class="keywordflow">if</span> (set)
    val = QString(<span class="stringliteral">"y"</span>);
    <span class="keywordflow">else</span>
    val = QString(<span class="stringliteral">"n"</span>);

    info-&gt;<a class="code" href="classQicsGridInfo.html#QicsGridInfoa3">dataModel</a>()-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModeli0">setItem</a>(model_row, model_col, val);
}


<span class="comment">/*</span>
<span class="comment"> * SSNValidator Methods</span>
<span class="comment"> */</span>

QValidator::State SSNValidator::validate( QString&amp; text, <span class="keywordtype">int</span>&amp; pos )<span class="keyword"> const</span>
<span class="keyword"></span>{
    <span class="comment">/* An empty string could be made acceptable */</span>
    <span class="keywordflow">if</span>( text == QString::null )
    {
        <span class="keywordflow">return</span> Valid;
    }

    <span class="comment">/* Protect against spurious calls to validate() */</span>
    <span class="keywordflow">if</span>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)pos &gt; text.length() )
    {
        <span class="keywordflow">return</span> Valid;
    }

   <span class="comment">/* Anything but decimal digits and dashes is invalid. We only need</span>
<span class="comment">    * to check the character at the cursor positions. This speeds</span>
<span class="comment">    * things up massively.</span>
<span class="comment">    */</span>

    <span class="keywordflow">if</span>( !text[pos-1].isDigit() &amp;&amp; ( text[pos-1] != <span class="charliteral">'-'</span> ) &amp;&amp; ( pos-1 &gt;= 0 ) )
    {
        <span class="keywordflow">return</span> Invalid;
    }

    <span class="comment">/* If the characters entered so far are valid, but the string</span>
<span class="comment">    * contains less than ten digits, it could be made acceptable, but</span>
<span class="comment">    * is not yet.</span>
<span class="comment">    */</span>
    <span class="keywordtype">int</span> numDigits = text.length();
    <span class="keywordtype">int</span> numDashes = 0;

    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; text.length(); i++)
    {
        <span class="keywordflow">if</span>(text.at(i) == QChar(<span class="charliteral">'-'</span>))
        {
                numDigits--;
                numDashes++;
        }
    }

    <span class="keywordflow">if</span>( numDigits &lt; 9 )
    {
        <span class="keywordflow">return</span> Valid;
    }

    <span class="comment">/* More than nine digits is always invalid */</span>
    <span class="keywordflow">if</span>( numDigits &gt; 9 )
    {
        <span class="keywordflow">return</span> Invalid;
    }

    <span class="keywordflow">if</span> (numDashes != 0)
    {
        <span class="keywordflow">return</span> Valid;
    }

    <span class="comment">/* numDashes = 0 and numDigits = 9 */</span>
    <span class="keywordflow">return</span> Acceptable;
}

<span class="keywordtype">void</span> 
SSNValidator::fixup( QString&amp; text )<span class="keyword"> const</span>
<span class="keyword"></span>{
    QString inString = text;
    <span class="keywordtype">int</span> inLength = inString.length();

    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=inLength; i &gt; 0; i--)
    {
        <span class="keywordflow">if</span>( inString[i] == <span class="charliteral">'-'</span> )
        {
            text.remove(i,1);
            qDebug (<span class="stringliteral">"Removing dash. \n"</span>);
        }
    }
}


<span class="comment">/*</span>
<span class="comment"> * The main Consult class</span>
<span class="comment"> */</span>

Consultant::Consultant(QWidget *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name) :
    QMainWindow(parent, name)
{
    <span class="comment">// create the data model </span>
    dataModel = <span class="keyword">new</span> QicsDataModelDefault(0, NUM_COLUMNS);

    <span class="comment">// create the table, using the data model we created above</span>
    table = <span class="keyword">new</span> QicsTable(dataModel, <span class="keyword">this</span>, name);
    setCentralWidget(table);

    <span class="comment">// customize the column header to make things look pretty</span>
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>().<a class="code" href="classQicsCellCommon.html#QicsTableCommoni52">setAlignment</a>(Qt::AlignCenter);

    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>().<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,0).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"First Name"</span>));
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>().<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,1).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Last Name"</span>));
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>().<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,2).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"S.S. Number"</span>));
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>().<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,3).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Date of Birth"</span>));
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>().<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,4).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Office"</span>));
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>().<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,5).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Sec. Clearance"</span>));
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>().<a class="code" href="classQicsHeader.html#QicsRowHeadera9">cellRef</a>(0,6).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni56">setLabel</a>(QString(<span class="stringliteral">"Billable Rate"</span>));

    <span class="comment">//Add a validator to the SSN to insure a consistant display </span>
    <span class="comment">//behaviour and error checking.</span>
    SSNValidator* ssnValidator = <span class="keyword">new</span> SSNValidator();
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea9">columnRef</a>(2).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni55">setValidator</a>(ssnValidator);
        
    <span class="comment">//Format the combo box for the office column</span>
    <a class="code" href="classQicsComboCellDisplay.html">QicsComboCellDisplay</a> *officeComboDisplay = <span class="keyword">new</span> <a class="code" href="classQicsComboCellDisplay.html">QicsComboCellDisplay</a>();
    officeComboDisplay-&gt;insertItem(QString(<span class="stringliteral">"Boston"</span>));
    officeComboDisplay-&gt;insertItem(QString(<span class="stringliteral">"Cambridge"</span>));
    officeComboDisplay-&gt;insertItem(QString(<span class="stringliteral">"Helsinki"</span>));
    officeComboDisplay-&gt;<a class="code" href="classQicsComboCellDisplay.html#QicsComboCellDisplaya8">setAddValueToList</a>(<span class="keyword">false</span>);
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea9">columnRef</a>(4).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni50">setDisplayer</a>(officeComboDisplay);

    <span class="comment">// Security clearance check box</span>
    SecCheckBox *columnHeaderCheckDisp = <span class="keyword">new</span> SecCheckBox();
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea9">columnRef</a>(5).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni52">setAlignment</a>(Qt::AlignCenter);
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea9">columnRef</a>(5).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni50">setDisplayer</a>(columnHeaderCheckDisp);

    <span class="comment">//Format the billable rate column with a dollar sign, decimal point, </span>
    <span class="comment">//and the appropriate cents digits.</span>
    <a class="code" href="classQicsDataItemSprintfFormatter.html">QicsDataItemSprintfFormatter</a> *brFormatter = <span class="keyword">new</span> <a class="code" href="classQicsDataItemSprintfFormatter.html">QicsDataItemSprintfFormatter</a>();
    brFormatter-&gt;<a class="code" href="classQicsDataItemSprintfFormatter.html#QicsDataItemSprintfFormattera3">addFormatString</a>(QicsDataItem_Float, <span class="stringliteral">"$%.2f"</span>);
    brFormatter-&gt;<a class="code" href="classQicsDataItemSprintfFormatter.html#QicsDataItemSprintfFormattera3">addFormatString</a>(QicsDataItem_Int, <span class="stringliteral">"$%d.00"</span>);  
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea9">columnRef</a>(6).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni51">setFormatter</a>(brFormatter);

    <span class="comment">// Add a title widget to the top of the table</span>
    QLabel *label = <span class="keyword">new</span> QLabel(QString(<span class="stringliteral">"Consultants"</span>), table);
    label-&gt;setAlignment(Qt::AlignCenter);
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablei49">setTopTitleWidget</a>(label);

    <span class="comment">//Set column widths</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; NUM_COLUMNS; i++)
    {
        table-&gt;<a class="code" href="classQicsTable.html#QicsTablea9">columnRef</a>(i).<a class="code" href="classQicsColumn.html#QicsColumni3">setWidthInChars</a>(7);
    }

    table-&gt;<a class="code" href="classQicsTable.html#QicsTablei73">setVisibleColumns</a>(NUM_COLUMNS);
    
    <span class="comment">//Menu Bar</span>
    QPopupMenu *filemenu = <span class="keyword">new</span> QPopupMenu;
    filemenu-&gt;insertItem( <span class="stringliteral">"Open..."</span> , <span class="keyword">this</span> , SLOT ( fileOpen() ) );
    filemenu-&gt;insertItem( <span class="stringliteral">"Save..."</span> , <span class="keyword">this</span> , SLOT ( fileSave() ) );
    filemenu-&gt;insertItem( <span class="stringliteral">"Quit"</span> , qApp , SLOT ( quit() ) );

    QPopupMenu *toolsmenu = <span class="keyword">new</span> QPopupMenu;
    toolsmenu-&gt;insertItem( <span class="stringliteral">"Add Consultant"</span>, <span class="keyword">this</span>, SLOT( addRow() ) );
    toolsmenu-&gt;insertItem( <span class="stringliteral">"Delete Consultant"</span>, <span class="keyword">this</span>, SLOT( deleteRow() ) );
    toolsmenu-&gt;insertItem( <span class="stringliteral">"Sort Ascending"</span>, <span class="keyword">this</span>, SLOT( sortAscending() ) );
    toolsmenu-&gt;insertItem( <span class="stringliteral">"Sort Descending"</span>, <span class="keyword">this</span>, SLOT( sortDescending() ) );

    QMenuBar *menubar = menuBar();
    menubar-&gt;insertItem( <span class="stringliteral">"File"</span> , filemenu );
    menubar-&gt;insertItem( <span class="stringliteral">"Tools"</span> , toolsmenu );

    <span class="comment">//Connection for autosort</span>
    QObject::connect( &amp;(table-&gt;<a class="code" href="classQicsTable.html#QicsTablea25">columnHeaderRef</a>()),
              SIGNAL( doubleClicked(<span class="keywordtype">int</span> , <span class="keywordtype">int</span> , <span class="keywordtype">int</span> , <span class="keyword">const</span> QPoint&amp;) ),
              <span class="keyword">this</span>,
              SLOT( autoSort(<span class="keywordtype">int</span>,  <span class="keywordtype">int</span> , <span class="keywordtype">int</span> , <span class="keyword">const</span> QPoint&amp;) ) ); 

    <span class="comment">//Reset autoSort sanity vars</span>
    _autoSortCol = -1;
    _autoSortOrder = Qics::Descending;
}

<span class="keywordtype">void</span>
Consultant::addRow()
{
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablei87">addRows</a>(1);
}

<span class="keywordtype">void</span>
Consultant::deleteRow()
{
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablei86">deleteRow</a>(table-&gt;<a class="code" href="classQicsTable.html#QicsTablea103">currentCell</a>()-&gt;<a class="code" href="classQicsCell.html#QicsCellz1_0">rowIndex</a>());
}

<span class="keywordtype">void</span>
Consultant::sortAscending()
{
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea91">sortRows</a>(table-&gt;<a class="code" href="classQicsTable.html#QicsTablea103">currentCell</a>()-&gt;<a class="code" href="classQicsCell.html#QicsCellz1_2">columnIndex</a>(), Qics::Ascending);
}

<span class="keywordtype">void</span>
Consultant::sortDescending()
{
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea91">sortRows</a>(table-&gt;<a class="code" href="classQicsTable.html#QicsTablea103">currentCell</a>()-&gt;<a class="code" href="classQicsCell.html#QicsCellz1_2">columnIndex</a>(), Qics::Descending);
}

<span class="keywordtype">void</span>
Consultant::fileOpen()
{
    QString inFileName = QFileDialog::getOpenFileName(<span class="stringliteral">"./"</span>,
                              <span class="stringliteral">"CSV files (*.csv)"</span>,
                              <span class="keyword">this</span>,
                              <span class="stringliteral">"open file dialog"</span>
                              <span class="stringliteral">"Choose a file"</span> );

    <span class="keywordflow">if</span> (inFileName.isEmpty())
    <span class="keywordflow">return</span>;

    QFile inFile(inFileName);

    <span class="keywordtype">int</span> error = 0;

    <span class="keywordflow">if</span> (inFile.open (IO_ReadOnly))
    {
    QTextStream inStream ( &amp;inFile );

    dataModel-&gt;readASCII(inStream, <span class="charliteral">','</span>, 0, 0, <span class="keyword">true</span>);
    inFile.close();
    }
    <span class="keywordflow">else</span>
    {
        qDebug(<span class="stringliteral">"Couldn't open %s"</span>, inFileName.ascii());
        error = 1;
    }

    <span class="keywordflow">if</span> (error)
    {
    QMessageBox *fileBox = <span class="keyword">new</span> QMessageBox();
    fileBox-&gt;setCaption( <span class="stringliteral">"File Operation"</span> );
        fileBox-&gt;setText( QString(<span class="stringliteral">"Could not read file: %1"</span>).arg(inFileName) );
    fileBox-&gt;setButtonText( 0 , <span class="stringliteral">"OK"</span> );
    fileBox-&gt;exec();
    <span class="keyword">delete</span> fileBox;
    }
}

<span class="keywordtype">void</span>
Consultant::fileSave()
{
    QString outFileName = QFileDialog::getSaveFileName(<span class="stringliteral">"./"</span>,
                               <span class="stringliteral">"CSV files (*.csv)"</span>,
                               <span class="keyword">this</span>,
                               <span class="stringliteral">"save file dialog"</span>
                               <span class="stringliteral">"Choose a file"</span> );

    <span class="keywordflow">if</span> (outFileName.isEmpty())
    <span class="keywordflow">return</span>;

    QFile outFile(outFileName);
  
    <span class="keywordtype">int</span> error = 0;

    <span class="keywordflow">if</span> (outFile.open (IO_WriteOnly))
    {
    QTextStream outStream ( &amp;outFile );

    dataModel-&gt;writeASCII(outStream, <span class="charliteral">','</span>);
    outStream &lt;&lt; <span class="stringliteral">"\n"</span>; 
    outFile.close();
    }
    <span class="keywordflow">else</span>
    {
        qDebug(<span class="stringliteral">"Couldn't open %s"</span>, outFileName.ascii());
        error = 1;
    }

    QMessageBox *fileBox = <span class="keyword">new</span> QMessageBox();
    fileBox-&gt;setCaption( <span class="stringliteral">"File Operation"</span> );
    <span class="keywordflow">if</span> ( error &lt; 1 )
    {
        fileBox-&gt;setText( QString(<span class="stringliteral">"Saved Table Data to %1"</span>).arg(outFileName) );
    }
    <span class="keywordflow">else</span>
    {
        fileBox-&gt;setText( QString(<span class="stringliteral">"Error Accessing %1"</span>).arg(outFileName) );
    }

    fileBox-&gt;setButtonText( 0 , <span class="stringliteral">"OK"</span> );
    fileBox-&gt;exec();
    <span class="keyword">delete</span> fileBox;
}

<span class="keywordtype">void</span>
Consultant::autoSort(<span class="keywordtype">int</span> , <span class="keywordtype">int</span> col, <span class="keywordtype">int</span> , <span class="keyword">const</span> QPoint &amp;)
{
    <span class="keywordflow">if</span> (_autoSortCol == col)
    {
        <span class="keywordflow">if</span> (_autoSortOrder == Qics::Ascending)
            _autoSortOrder = Qics::Descending;
        <span class="keywordflow">else</span>
            _autoSortOrder = Qics::Ascending;
    }
    <span class="keywordflow">else</span>
    {
        _autoSortCol = col;
        _autoSortOrder = Qics::Ascending;
    }

    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea91">sortRows</a>(col, _autoSortOrder);
}
</pre></div> <!-- footer -->
<P>
<center>
<font size="1">
All trademarks and copyrights on this page are properties of
their respective owners.<br> The rest is copyright ©1999-2003 Integrated
Computer Solutions, Inc.
</font>
</center>
<!-- end footer -->
