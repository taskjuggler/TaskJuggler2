<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>frozen.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<a href="http://www.ics.com/index.html">
<img src="ics.jpg" border="0" alt="ICS">
</a>
<center>
<H2>QicsTable Documentation Set</H2>
</center>
</a></head><body>


<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1><a name="frozen_cpp">frozen.cpp</a>
</h1><div class="fragment"><pre><span class="comment">/****************************************************************************</span>
<span class="comment">** $RCSfile$ $Date$</span>
<span class="comment">**</span>
<span class="comment">** Copyright ( C ) 2002-2003 Integrated Computer Solutions, Inc.</span>
<span class="comment">** All rights reserved.</span>
<span class="comment">**</span>
<span class="comment">** This file is part of an example program for QicsTable.  This example</span>
<span class="comment">** program may be used, distributed and modified without limitation.</span>
<span class="comment">**</span>
<span class="comment">*****************************************************************************/</span>

<span class="preprocessor">#include "frozen.h"</span>


FrozenUI::FrozenUI(<a class="code" href="classQicsDataModel.html">QicsDataModel</a> *dm) :
    QObject()
{
    myMainWindow = <span class="keyword">new</span> QMainWindow();
    
    myTable = <span class="keyword">new</span> QicsTable(dm, myMainWindow);

    <span class="keywordtype">int</span> i;

    <span class="comment">// Set some labels on the row and column headers</span>

    <span class="keywordflow">for</span> (i = 0; i &lt; dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta7">numRows</a>(); i++)
    myTable-&gt;rowHeaderRef().cellRef(i,0).setLabel(QString(<span class="stringliteral">"Row %1"</span>).arg(i));

    <span class="keywordflow">for</span> (i = 0; i &lt; dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta8">numColumns</a>(); i++)
    myTable-&gt;columnHeaderRef().cellRef(0,i).setLabel(QString(<span class="stringliteral">"Col %1"</span>).arg(i));

    myMainWindow-&gt;setCentralWidget(myTable);

    <span class="comment">// Dialogs for use in the future</span>

    myFrozenDialog = <span class="keyword">new</span> QicsFrozenConfigDialog(<span class="stringliteral">"frozenConfigDialolg"</span>,
                        myMainWindow);

    myMoveDialog = <span class="keyword">new</span> MoveDialog(<span class="stringliteral">"moveDialog"</span>, myMainWindow);

    <span class="comment">// Menu system</span>

    QMenuBar *menu = myMainWindow-&gt;menuBar();
    
    QPopupMenu *file = <span class="keyword">new</span> QPopupMenu(myMainWindow);
    file-&gt;insertItem(<span class="stringliteral">"E&amp;xit"</span>, qApp, SLOT(quit()));
    menu-&gt;insertItem(<span class="stringliteral">"&amp;File"</span>, file);

    QPopupMenu *view = <span class="keyword">new</span> QPopupMenu(myMainWindow);
    view-&gt;insertItem(<span class="stringliteral">"F&amp;reeze..."</span>, <span class="keyword">this</span>, SLOT(doFrozenConfig()));
    view-&gt;insertItem(<span class="stringliteral">"&amp;Move..."</span>, <span class="keyword">this</span>, SLOT(doMoveConfig()));
    menu-&gt;insertItem(<span class="stringliteral">"&amp;View"</span>, view);

    myMainWindow-&gt;show();
}

FrozenUI::~FrozenUI()
{
    <span class="keyword">delete</span> myMainWindow;
}

<span class="keywordtype">void</span>
FrozenUI::doFrozenConfig(<span class="keywordtype">void</span>)
{
    <span class="comment">// Pop up the frozen dialog, wait until the user dismisses it</span>

    myFrozenDialog-&gt;exec();

    <span class="comment">// Now do what the user requested</span>

    <span class="keywordflow">if</span> (myFrozenDialog-&gt;freezeTopRows())
    myTable-&gt;freezeTopRows(myFrozenDialog-&gt;numTopFrozenRows());

    <span class="keywordflow">if</span> (myFrozenDialog-&gt;freezeBottomRows())
    myTable-&gt;freezeBottomRows(myFrozenDialog-&gt;numBottomFrozenRows());

    <span class="keywordflow">if</span> (myFrozenDialog-&gt;freezeLeftColumns())
    myTable-&gt;freezeLeftColumns(myFrozenDialog-&gt;numLeftFrozenCols());

    <span class="keywordflow">if</span> (myFrozenDialog-&gt;freezeRightColumns())
    myTable-&gt;freezeRightColumns(myFrozenDialog-&gt;numRightFrozenCols());
}

<span class="keywordtype">void</span>
FrozenUI::doMoveConfig(<span class="keywordtype">void</span>)
{
    <span class="comment">// Pop up the move dialog, wait until the user dismisses it</span>

    myMoveDialog-&gt;exec();

    <span class="comment">// Now do what the user requested</span>

    <span class="keywordflow">if</span> (myMoveDialog-&gt;moveToTop() || myMoveDialog-&gt;moveToBottom())
    {
    <span class="comment">// We are moving rows</span>

    QMemArray&lt;int&gt; rows_to_move;

    <a class="code" href="classQicsSelectionList.html">QicsSelectionList</a> *slist = myTable-&gt;selectionList();
    QicsSelectionList::iterator iter;
    <span class="keywordflow">for</span> (iter = slist-&gt;begin(); iter != slist-&gt;end(); ++iter)
    {
        <span class="comment">// For each selection in the selection list, check to</span>
        <span class="comment">// ensure that the selection is an entire row (or rows).</span>
        <span class="comment">// If it is, add the row indices to the rows_to_move list.</span>

        <span class="keyword">const</span> <a class="code" href="classQicsSelection.html">QicsSelection</a> &amp;sel = *iter;

        <span class="keywordflow">if</span> ((sel.<a class="code" href="classQicsSelection.html#QicsSelectiona17">leftColumn</a>() == 0) &amp;&amp;
        (sel.<a class="code" href="classQicsSelection.html#QicsSelectiona19">rightColumn</a>() == Qics::QicsLAST_COLUMN))
        {
        <span class="keywordtype">int</span> nrows = rows_to_move.size();

        rows_to_move.resize(nrows + (sel.<a class="code" href="classQicsSelection.html#QicsSelectiona18">bottomRow</a>() - sel.<a class="code" href="classQicsSelection.html#QicsSelectiona16">topRow</a>() + 1));

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = sel.<a class="code" href="classQicsSelection.html#QicsSelectiona16">topRow</a>(); i &lt;= sel.<a class="code" href="classQicsSelection.html#QicsSelectiona18">bottomRow</a>(); ++i)
        {
            rows_to_move[nrows++] = i;
        }
        }
    }

    <span class="comment">// This ensures that the rows are moved in the correct order</span>
    rows_to_move.sort();

    <span class="comment">// Now we can move the rows to the top or the bottom</span>
    myTable-&gt;moveRows((myMoveDialog-&gt;moveToTop() ? 0 : myTable-&gt;bottomRow() + 1),
              rows_to_move);
    }

    <span class="keywordflow">if</span> (myMoveDialog-&gt;moveToLeft() || myMoveDialog-&gt;moveToRight())
    {
    <span class="comment">// We are moving columns</span>

    QMemArray&lt;int&gt; cols_to_move;

    <a class="code" href="classQicsSelectionList.html">QicsSelectionList</a> *slist = myTable-&gt;selectionList();
    QicsSelectionList::iterator iter;
    <span class="keywordflow">for</span> (iter = slist-&gt;begin(); iter != slist-&gt;end(); ++iter)
    {
        <span class="comment">// For each selection in the selection list, check to</span>
        <span class="comment">// ensure that the selection is an entire column (or columns).</span>
        <span class="comment">// If it is, add the column indices to the cols_to_move list.</span>

        <span class="keyword">const</span> <a class="code" href="classQicsSelection.html">QicsSelection</a> &amp;sel = *iter;

        <span class="keywordflow">if</span> ((sel.<a class="code" href="classQicsSelection.html#QicsSelectiona16">topRow</a>() == 0) &amp;&amp;
        (sel.<a class="code" href="classQicsSelection.html#QicsSelectiona18">bottomRow</a>() == Qics::QicsLAST_ROW))
        {
        <span class="keywordtype">int</span> ncols = cols_to_move.size();

        cols_to_move.resize(ncols + 
                    (sel.<a class="code" href="classQicsSelection.html#QicsSelectiona19">rightColumn</a>() - sel.<a class="code" href="classQicsSelection.html#QicsSelectiona17">leftColumn</a>() + 1));

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = sel.<a class="code" href="classQicsSelection.html#QicsSelectiona17">leftColumn</a>(); i &lt;= sel.<a class="code" href="classQicsSelection.html#QicsSelectiona19">rightColumn</a>(); ++i)
        {
            cols_to_move[ncols++] = i;
        }
        }
    }

    <span class="comment">// This ensures that the columns are moved in the correct order</span>
    cols_to_move.sort();

    <span class="comment">// Now we can move the columns to the left or the right</span>
    myTable-&gt;moveColumns((myMoveDialog-&gt;moveToLeft() ? 0 :
                  myTable-&gt;rightColumn() + 1),
                 cols_to_move);
    }
}


MoveDialog::MoveDialog(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, QWidget *parent) :
    QDialog(parent, name)
{
    QVBoxLayout *box = <span class="keyword">new</span> QVBoxLayout(<span class="keyword">this</span>, 2);

    QButtonGroup *bg = <span class="keyword">new</span> QButtonGroup(1, Qt::Horizontal, <span class="keyword">this</span>);

    _mTop = <span class="keyword">new</span> QRadioButton(bg);
    _mTop-&gt;setText(<span class="stringliteral">"Move Rows to Top"</span>);

    _mBottom = <span class="keyword">new</span> QRadioButton(bg);
    _mBottom-&gt;setText(<span class="stringliteral">"Move Rows to Bottom"</span>);

    _mLeft = <span class="keyword">new</span> QRadioButton(bg);
    _mLeft-&gt;setText(<span class="stringliteral">"Move Columns to Left"</span>);

    _mRight = <span class="keyword">new</span> QRadioButton(bg);
    _mRight-&gt;setText(<span class="stringliteral">"Move Columns to Right"</span>);

    box-&gt;addWidget(bg);

    QHBoxLayout *row = <span class="keyword">new</span> QHBoxLayout(box);

    QPushButton *ok = <span class="keyword">new</span> QPushButton(<span class="keyword">this</span>, <span class="stringliteral">"OkButton"</span>);
    ok-&gt;setText(<span class="stringliteral">"OK"</span>);
    row-&gt;addWidget(ok);
    connect(ok, SIGNAL(clicked()),
        <span class="keyword">this</span>, SLOT(accept()) );

    QPushButton *cancel = <span class="keyword">new</span> QPushButton(<span class="keyword">this</span>, <span class="stringliteral">"CancelButton"</span>);
    cancel-&gt;setText(<span class="stringliteral">"Cancel"</span>);
    row-&gt;addWidget(cancel);
    connect(cancel, SIGNAL(clicked()),
        <span class="keyword">this</span>, SLOT(reject()) );
}


<span class="keywordtype">void</span> MoveDialog::exec()
{
    _moveToTop = <span class="keyword">false</span>;
    _moveToBottom = <span class="keyword">false</span>;
    _moveToLeft = <span class="keyword">false</span>;
    _moveToRight = <span class="keyword">false</span>;

    <span class="keywordflow">if</span> (QDialog::exec() == QDialog::Accepted)
    {
    <span class="keywordflow">if</span> (_mTop-&gt;isOn())
        _moveToTop = <span class="keyword">true</span>;
    
    <span class="keywordflow">if</span> (_mBottom-&gt;isOn())
        _moveToBottom = <span class="keyword">true</span>;
    
    <span class="keywordflow">if</span> (_mLeft-&gt;isOn())
        _moveToLeft = <span class="keyword">true</span>;

    <span class="keywordflow">if</span> (_mRight-&gt;isOn())
        _moveToRight = <span class="keyword">true</span>;
    }

}


FrozenApp::FrozenApp(<span class="keywordtype">int</span> &amp;argc, <span class="keywordtype">char</span> **argv) :
    QApplication(argc, argv)
{
    myModel = createModel(50, 50);
    myUI = createUI(myModel);

    setMainWidget(myUI-&gt;base());
}

FrozenApp::~FrozenApp()
{
    <span class="keyword">delete</span> myUI;
    <span class="keyword">delete</span> myModel;
}

<a class="code" href="classQicsDataModel.html">QicsDataModel</a> *
FrozenApp::createModel(<span class="keywordtype">int</span> nrows, <span class="keywordtype">int</span> ncols)
{
    <a class="code" href="classQicsDataModel.html">QicsDataModel</a> *dm = <span class="keyword">new</span> QicsDataModelDefault(nrows, ncols);

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nrows; ++i)
    {
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; ncols; ++j)
    {
        dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModeli0">setItem</a>(i, j, (i+j));
    }
    }

    <span class="keywordflow">return</span> dm;
}

FrozenUI *
FrozenApp::createUI(<a class="code" href="classQicsDataModel.html">QicsDataModel</a> *dm)
{
    <span class="keywordflow">return</span> (<span class="keyword">new</span> FrozenUI(dm));
}


<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
    FrozenApp app(argc,argv);

    <span class="keywordflow">return</span> app.exec();
}

</pre></div> <!-- footer -->
<P>
<center>
<font size="1">
All trademarks and copyrights on this page are properties of
their respective owners.<br> The rest is copyright ©1999-2003 Integrated
Computer Solutions, Inc.
</font>
</center>
<!-- end footer -->
