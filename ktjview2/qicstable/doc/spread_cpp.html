<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>spreadsheet.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<a href="http://www.ics.com/index.html">
<img src="ics.jpg" border="0" alt="ICS">
</a>
<center>
<H2>QicsTable Documentation Set</H2>
</center>
</a></head><body>


<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1><a name="spread_cpp">spreadsheet.cpp</a>
</h1><div class="fragment"><pre><span class="comment">/****************************************************************************</span>
<span class="comment">** $RCSfile$ $Date$</span>
<span class="comment">**</span>
<span class="comment">** Copyright ( C ) 2002-2003 Integrated Computer Solutions, Inc.</span>
<span class="comment">** All rights reserved.</span>
<span class="comment">**</span>
<span class="comment">** This file is part of an example program for QicsTable.  This example</span>
<span class="comment">** program may be used, distributed and modified without limitation.</span>
<span class="comment">**</span>
<span class="comment">*****************************************************************************/</span>

<span class="comment">//----------------------------------------------------------------------------</span>
<span class="comment">//   Object that wraps a QicsTable and does an "Excel-lent" spreadsheet.</span>
<span class="comment">//   Note that QSA support can be added in by modfiying the .pro file</span>
<span class="comment">//----------------------------------------------------------------------------</span>

<span class="preprocessor">#include &lt;qapplication.h&gt;</span>
<span class="preprocessor">#include &lt;qstringlist.h&gt;</span>

<span class="preprocessor">#include "spreadsheet.h"</span>
<span class="preprocessor">#include "QicsDataItemCurrencyFormatter.h"</span>

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  Spreadsheet constructor</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Constructor the Spreadsheet object.  Creates a QMainWindow with a menu</span>
<span class="comment"> *    and toolbar, a QicsTable, and connects the appropriate slots to load</span>
<span class="comment"> *    and manipulate data.</span>
<span class="comment"> */</span>

Spreadsheet::Spreadsheet(QWidget* p, <span class="keyword">const</span> <span class="keywordtype">char</span>* name) :
    QMainWindow(p, name)
{

    setCaption(<span class="stringliteral">"Excellent Spreadsheet Demo"</span>);

    <span class="comment">/*</span>
<span class="comment">     *  Pulldown Menu</span>
<span class="comment">     */</span>

    <span class="comment">// File</span>
    QPopupMenu* file = <span class="keyword">new</span> QPopupMenu(<span class="keyword">this</span>);
    menuBar()-&gt;insertItem(<span class="stringliteral">"&amp;File"</span>, file);

    file-&gt;insertItem(<span class="stringliteral">"&amp;New"</span>, <span class="keyword">this</span>, SLOT(fileNew()), CTRL+Key_N);
    file-&gt;insertItem(<span class="stringliteral">"&amp;Open"</span>, <span class="keyword">this</span>, SLOT(openFile()), CTRL+Key_O);
    file-&gt;insertItem(<span class="stringliteral">"&amp;Save"</span>, <span class="keyword">this</span>, SLOT(saveFile()), CTRL+Key_S);
    file-&gt;insertItem(<span class="stringliteral">"S&amp;ave As"</span>, <span class="keyword">this</span>, SLOT(saveFileAs()));
    file-&gt;insertSeparator();
    file-&gt;insertItem(<span class="stringliteral">"E&amp;xit"</span>, qApp, SLOT(closeAllWindows()), CTRL+Key_X);

    <span class="comment">// Edit</span>
    QPopupMenu* edit = <span class="keyword">new</span> QPopupMenu(<span class="keyword">this</span>);
    menuBar()-&gt;insertItem(<span class="stringliteral">"&amp;Edit"</span>, edit);

    edit-&gt;insertItem(<span class="stringliteral">"&amp;Copy"</span>, <span class="keyword">this</span>, SLOT(copy()), CTRL+Key_C);
    edit-&gt;insertItem(<span class="stringliteral">"&amp;Paste"</span>, <span class="keyword">this</span>, SLOT(paste()), CTRL+Key_V);

    <span class="comment">// View</span>
    QPopupMenu* view = <span class="keyword">new</span> QPopupMenu(<span class="keyword">this</span>);
    menuBar()-&gt;insertItem(<span class="stringliteral">"&amp;View"</span>, view);

    <span class="comment">// Insert</span>
    QPopupMenu* insert = <span class="keyword">new</span> QPopupMenu(<span class="keyword">this</span>);
    menuBar()-&gt;insertItem(<span class="stringliteral">"&amp;Insert"</span>, insert);
    
    insert-&gt;insertItem(<span class="stringliteral">"&amp;Row"</span>, <span class="keyword">this</span>, SLOT(insertRow()));
    insert-&gt;insertItem(<span class="stringliteral">"&amp;Column"</span>, <span class="keyword">this</span>, SLOT(insertColumn()));

    <span class="comment">// Format</span>
    QPopupMenu* format = <span class="keyword">new</span> QPopupMenu(<span class="keyword">this</span>);
    menuBar()-&gt;insertItem(<span class="stringliteral">"F&amp;ormat"</span>, format);

    QPopupMenu* rowFormat =  <span class="keyword">new</span> QPopupMenu(<span class="keyword">this</span>);
    <span class="comment">//rowFormat-&gt;insertItem("&amp;Freeze", this, SLOT(freezeWholeRows()));</span>
    <span class="comment">//rowFormat-&gt;insertItem("&amp;Unfreeze", this, SLOT(unfreezeRows()));</span>

    format-&gt;insertItem(<span class="stringliteral">"&amp;Row"</span>, rowFormat);

    format-&gt;insertSeparator();

    format-&gt;insertItem(<span class="stringliteral">"&amp;Font..."</span>, <span class="keyword">this</span>, SLOT(formatFont()));
    format-&gt;insertItem(<span class="stringliteral">"Fore&amp;ground..."</span>, <span class="keyword">this</span>, 
                       SLOT(formatForegroundColor()));
    format-&gt;insertItem(<span class="stringliteral">"&amp;Background..."</span>, <span class="keyword">this</span>, 
                       SLOT(formatBackgroundColor()));

    <span class="comment">// Tools</span>
    QPopupMenu* tools = <span class="keyword">new</span> QPopupMenu(<span class="keyword">this</span>);
    menuBar()-&gt;insertItem(<span class="stringliteral">"&amp;Tools"</span>, tools);
    tools-&gt;insertItem(<span class="stringliteral">"&amp;Script Editor"</span>, <span class="keyword">this</span>, SLOT(showQSAWorkbench()));
    tools-&gt;insertItem(<span class="stringliteral">"Script &amp;Test"</span>, <span class="keyword">this</span>, SLOT(testScripts()));
    tools-&gt;insertItem(<span class="stringliteral">"Save Scripts"</span>, <span class="keyword">this</span>, SLOT(saveScripts()));

    <span class="comment">// Data</span>
    QPopupMenu* data = <span class="keyword">new</span> QPopupMenu(<span class="keyword">this</span>);
    menuBar()-&gt;insertItem(<span class="stringliteral">"&amp;Data"</span>, data);
    data-&gt;insertItem(<span class="stringliteral">"Sort &amp;Ascending"</span>, <span class="keyword">this</span>, SLOT(sortAscending()));
    data-&gt;insertItem(<span class="stringliteral">"Sort &amp;Descending"</span>, <span class="keyword">this</span>, SLOT(sortDescending()));

    <span class="comment">/*</span>
<span class="comment">     * Toolbars</span>
<span class="comment">     */</span>

    <span class="comment">// File operation toolbar</span>

    QToolBar* fileTools = <span class="keyword">new</span> QToolBar(<span class="keyword">this</span>, <span class="stringliteral">"file tools"</span>);
    fileTools-&gt;setLabel(<span class="stringliteral">"File Tools"</span>);

    <span class="keyword">new</span> QToolButton(QPixmap(filenew), <span class="stringliteral">"New"</span>, QString::null,
                    <span class="keyword">this</span>, SLOT(fileNew()),
                    fileTools);

    <span class="keyword">new</span> QToolButton(QPixmap(fileopen), <span class="stringliteral">"Open File"</span>, QString::null,
                    <span class="keyword">this</span>, SLOT(openFile()),
                    fileTools);

    <span class="keyword">new</span> QToolButton(QPixmap(filesave), <span class="stringliteral">"Save File"</span>, QString::null,
                    <span class="keyword">this</span>, SLOT(saveFile()),
                    fileTools);

    fileTools-&gt;addSeparator();

    <span class="comment">// Edit operations</span>

    QToolButton* editCutTB = 
        <span class="keyword">new</span> QToolButton(QPixmap(editcut), <span class="stringliteral">"Cut"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(cut()),
                        fileTools);
    Q_ASSERT(NULL != editCutTB);

    QToolButton* editCopyTB = 
        <span class="keyword">new</span> QToolButton(QPixmap(editcopy), <span class="stringliteral">"Copy"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(copy()),
                        fileTools);
    Q_ASSERT(NULL != editCopyTB);

    QToolButton* editPasteTB = 
        <span class="keyword">new</span> QToolButton(QPixmap(editpaste), <span class="stringliteral">"Paste"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(paste()),
                        fileTools);
    Q_ASSERT(NULL != editPasteTB);

    fileTools-&gt;addSeparator();

    <span class="comment">// Sort</span>

    QToolButton* sortAscTB =
        <span class="keyword">new</span> QToolButton(QPixmap(sortasc_xpm), <span class="stringliteral">"Sort Ascending"</span>, 
                        QString::null, <span class="keyword">this</span>, 
                        SLOT(sortAscending()), fileTools);
    Q_ASSERT(NULL != sortAscTB);

    QToolButton* sortDesTB =
        <span class="keyword">new</span> QToolButton(QPixmap(sortdesc_xpm), <span class="stringliteral">"Sort Descending"</span>, 
                        QString::null, <span class="keyword">this</span>,
                        SLOT(sortDescending()), fileTools);
    Q_ASSERT(NULL != sortDesTB);

    fileTools-&gt;addSeparator();

    <span class="comment">// Font name and point size</span>

    QToolBar* fontTools = <span class="keyword">new</span> QToolBar(<span class="keyword">this</span>, <span class="stringliteral">"Font tools"</span>);
    fontTools-&gt;setLabel(<span class="stringliteral">"Font Tools"</span>);

    fontFamilyCombo = <span class="keyword">new</span> QComboBox(<span class="keyword">false</span>, fontTools, <span class="stringliteral">"fontFamilyCombo"</span>);
    fontSizeCombo = <span class="keyword">new</span> QComboBox(<span class="keyword">false</span>, fontTools, <span class="stringliteral">"fontSizeCombo"</span>);

    connect(fontFamilyCombo, SIGNAL(activated(<span class="keywordtype">int</span>)),
        <span class="keyword">this</span>, SLOT(selectFont(<span class="keywordtype">int</span>)));

    connect(fontSizeCombo, SIGNAL(activated(<span class="keywordtype">int</span>)),
        <span class="keyword">this</span>, SLOT(selectFont(<span class="keywordtype">int</span>)));

    QFontDatabase fdb;
    QStringList families = fdb.families();
    fontFamilyCombo-&gt;insertStringList(families);

    <span class="comment">// Font format operations</span>

    fontBoldTB =
        <span class="keyword">new</span> QToolButton(QPixmap(textbold), <span class="stringliteral">"Bold"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(textBold()),
                        fontTools);
    fontBoldTB-&gt;setToggleButton(<span class="keyword">true</span>);

    fontItalicTB =
        <span class="keyword">new</span> QToolButton(QPixmap(textitalic), <span class="stringliteral">"Italic"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(textItalic()),
                        fontTools);
    fontItalicTB-&gt;setToggleButton(<span class="keyword">true</span>);

    fontUnderlineTB =
        <span class="keyword">new</span> QToolButton(QPixmap(textunder), <span class="stringliteral">"Underline"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(textUnderline()),
                        fontTools);
    fontUnderlineTB-&gt;setToggleButton(<span class="keyword">true</span>);

    fontTools-&gt;addSeparator();

    <span class="comment">// Text Alignment</span>

    textLeftTB =
        <span class="keyword">new</span> QToolButton(QPixmap(textleft), <span class="stringliteral">"Align Left"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(textAlignLeft()),
                        fontTools);
    textLeftTB-&gt;setToggleButton(<span class="keyword">true</span>);

    textCenterTB =
        <span class="keyword">new</span> QToolButton(QPixmap(textcenter), <span class="stringliteral">"Align Center"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(textAlignCenter()),
                        fontTools);
    textCenterTB-&gt;setToggleButton(<span class="keyword">true</span>);

    textRightTB =
        <span class="keyword">new</span> QToolButton(QPixmap(textright), <span class="stringliteral">"Align Right"</span>, QString::null,
                        <span class="keyword">this</span>, SLOT(textAlignRight()),
                        fontTools);
    textRightTB-&gt;setToggleButton(<span class="keyword">true</span>);

    fontTools-&gt;addSeparator();

    <span class="comment">// Formatters</span>
    QToolButton* currencyTB =
        <span class="keyword">new</span> QToolButton(fontTools);
    currencyTB-&gt;setTextLabel(<span class="stringliteral">"$"</span>);
    currencyTB-&gt;setUsesTextLabel(<span class="keyword">true</span>);
    connect(currencyTB, SIGNAL(clicked()),
            <span class="keyword">this</span>, SLOT(setCurrencyFormatter()));

    fontTools-&gt;addSeparator();

    <span class="comment">// Colors</span>

    <span class="keyword">new</span> QToolButton(QPixmap(fillcolor_xpm), <span class="stringliteral">"Fill Color"</span>, QString::null,
                    <span class="keyword">this</span>, SLOT(formatBackgroundColor()), fontTools);

    <span class="keyword">new</span> QToolButton(QPixmap(fontcolor_xpm), <span class="stringliteral">"Font Color"</span>, QString::null,
                    <span class="keyword">this</span>, SLOT(formatForegroundColor()), fontTools);

    <span class="comment">/*</span>
<span class="comment">     *  Table</span>
<span class="comment">     */</span>

    QVBox* vbox = <span class="keyword">new</span> QVBox(<span class="keyword">this</span>);

    QHBox* cellrow = <span class="keyword">new</span> QHBox(vbox);
    cellrow-&gt;setMargin(2);
    QLabel* cellLabel = <span class="keyword">new</span> QLabel(<span class="stringliteral">"Cell Value = "</span>, cellrow);
    Q_ASSERT(NULL != cellLabel);

    cellLineEdit = <span class="keyword">new</span> QLineEdit(cellrow);
    connect(cellLineEdit, SIGNAL(returnPressed()),
            <span class="keyword">this</span>, SLOT(cellLineUpdate()));

    <span class="keywordtype">int</span> lastRow = 10;
    <span class="keywordtype">int</span> lastCol = 50;

    <span class="comment">// create the data model</span>
    dm = <span class="keyword">new</span> QicsDataModelDefault(lastRow, lastCol);
    
    <span class="comment">// create the table, using the data model we created above</span>
    table = <span class="keyword">new</span> QicsTable(dm, vbox);
    <span class="comment">//table-&gt;setViewport(QicsRegion(0, 0, 50, 50));</span>

    connect(table, SIGNAL(selectionListChanged(<span class="keywordtype">bool</span>)),
            <span class="keyword">this</span>, SLOT(updateSelection(<span class="keywordtype">bool</span>)));

    <span class="comment">// Set some visual resources on the table</span>
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea23">rowHeader</a>()-&gt;<a class="code" href="classQicsCellCommon.html#QicsTableCommoni52">setAlignment</a>(Qt::AlignHCenter);
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea27">columnHeader</a>()-&gt;<a class="code" href="classQicsCellCommon.html#QicsTableCommoni52">setAlignment</a>(Qt::AlignHCenter);
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea23">rowHeader</a>()-&gt;<a class="code" href="classQicsHeader.html#QicsRowHeadera8">column</a>(0)-&gt;<a class="code" href="classQicsColumn.html#QicsColumni3">setWidthInChars</a>(3);
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea17">mainGridRef</a>().<a class="code" href="classQicsCellCommon.html#QicsTableCommoni45">setBackgroundColor</a>(Qt::white);

    table-&gt;show();

    setFontCombos(table-&gt;font());

    setCentralWidget(vbox);

    statusBar()-&gt;message(<span class="stringliteral">"Ready"</span>, -1);

    fileName = QString::null;

<span class="preprocessor">#ifdef QSA</span>
<span class="preprocessor"></span>
    <span class="comment">// QSA Initialization</span>
    project = <span class="keyword">new</span> QSProject( <span class="keyword">this</span>, <span class="stringliteral">"spreadsheet_project"</span> );
    project-&gt;addObject(<span class="keyword">this</span>);
    QSInterpreter* interpreter = project-&gt;interpreter();

    <span class="comment">//project-&gt;load( "/opt/qsa-x11-free-1.0.0/examples/spreadsheet/spreadsheet.qsa" );</span>
    project-&gt;load( <span class="stringliteral">"Spreadsheet.qsa"</span> );
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}

<span class="preprocessor">#ifdef QSA</span>
<span class="preprocessor"></span>
<span class="comment">// Prototype QSA support methods</span>

<span class="keywordtype">void</span> Spreadsheet::saveScripts()
{
    project-&gt;save(<span class="stringliteral">"Spreadsheet.qsa"</span>);
}

<span class="keywordtype">void</span> Spreadsheet::testScripts()
{
    QStringList list = project-&gt;interpreter()-&gt;functions();

    <span class="comment">//qDebug("Test Scripts");</span>

    <span class="keywordflow">for</span> (QStringList::Iterator it = list.begin();
         it != list.end(); ++it)
    {
        cout &lt;&lt; *it &lt;&lt; endl;
    }

    <span class="comment">// Hardcoded here, call function "sum" with specified args</span>

    QValueList&lt;QVariant&gt; args;

    args.append(1);
    args.append(1);

    <span class="comment">// call the function</span>
    project-&gt;interpreter()-&gt;call(<span class="stringliteral">"sum"</span>, args); <span class="comment">//QValueList&lt;QVariant&gt;() );</span>

    QSScript* script = project-&gt;script(<span class="stringliteral">"Spreadsheet.qs"</span>);

    <span class="keywordflow">if</span> (script)
        cout &lt;&lt; script-&gt;code() &lt;&lt; endl;
    <span class="keywordflow">else</span>
        cout &lt;&lt; <span class="stringliteral">"No script by that name"</span> &lt;&lt; endl;
}

<span class="keyword">static</span> QSWorkbench *spreadsheet_ide = 0;

<span class="keywordtype">void</span> Spreadsheet::showQSAWorkbench()
{
    
    <span class="keywordflow">if</span> (!spreadsheet_ide )
    {
        spreadsheet_ide = <span class="keyword">new</span> QSWorkbench( project, <span class="keyword">this</span>, <span class="stringliteral">"qside"</span> );

    }
    
    spreadsheet_ide-&gt;open();
}

<span class="preprocessor">#else</span>
<span class="preprocessor"></span>
<span class="comment">// Warn user that there is no QSA support compiled in</span>

<span class="keywordtype">void</span> Spreadsheet::showQSAWorkbench()
{
    QMessageBox::warning(0, tr(<span class="stringliteral">"No QSA support!"</span>), 
                         tr(<span class="stringliteral">"Sorry, no QSA support compiled in"</span>),
                         QMessageBox::Ok, QMessageBox::NoButton);
}

<span class="keywordtype">void</span> Spreadsheet::testScripts() 
{
    QMessageBox::warning(0, tr(<span class="stringliteral">"No QSA support!"</span>), 
                         tr(<span class="stringliteral">"Sorry, no QSA support compiled in"</span>),
                         QMessageBox::Ok, QMessageBox::NoButton);
}

<span class="keywordtype">void</span> Spreadsheet::saveScripts()
{
    QMessageBox::warning(0, tr(<span class="stringliteral">"No QSA support!"</span>), 
                         tr(<span class="stringliteral">"Sorry, no QSA support compiled in"</span>),
                         QMessageBox::Ok, QMessageBox::NoButton);
}

<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  setCurrencyFormatter</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Set a formatter on the selected cells do display the values</span>
<span class="comment"> *    in dollar value ($ XX.YY)</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::setCurrencyFormatter()
{
    this-&gt;getSelectedRegion();

    <span class="keywordflow">if</span> ( (startSelectedRow &gt; -1 ) &amp;&amp; (startSelectedColumn &gt; -1) )
      {
        <span class="keywordtype">int</span> i, j;

        QicsDataItemCurrencyFormatter* currency =
            <span class="keyword">new</span> QicsDataItemCurrencyFormatter();

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i,j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni51">setFormatter</a>(currency);
          
      }

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  getCellValue</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Return the value of cell[row][col]</span>
<span class="comment"> */</span>

QString Spreadsheet::getCellValue(<span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col)
{
    <span class="keywordflow">return</span> dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta12">itemString</a>(row, col);
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  setCellValue</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Set cell[row][col] = value</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::setCellValue(<span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col, <span class="keywordtype">int</span> value)
{
    dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModeli0">setItem</a>(row, col, value);
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  cellLineUpdate()</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    When a value is entered in the cellLineEdit and a cell is selected in</span>
<span class="comment"> *    the table, store the data element as a new data item.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::cellLineUpdate()
{

    this-&gt;getSelectedRegion();

    <span class="keywordflow">if</span> ( (startSelectedRow &gt; -1 ) &amp;&amp; (startSelectedColumn &gt; -1) )
    {
        <span class="comment">// OK, we got a selected cell and some data.  Time to</span>
        <span class="comment">// put it into the data model</span>

        <span class="comment">// temp var because they are easier to type</span>
        <span class="keywordtype">int</span> row = startSelectedRow;
        <span class="keywordtype">int</span> col = startSelectedColumn;

    <span class="keywordtype">bool</span> ok;

    <span class="comment">// Try to convert to int</span>
    <span class="keywordtype">int</span> i = cellLineEdit-&gt;text().toInt(&amp;ok);

    <span class="keywordflow">if</span> (ok)
      {
        dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModeli0">setItem</a>(row, col, i);
        <span class="keywordflow">return</span>;
      }

    <span class="comment">// Try to convert to float</span>
    <span class="keywordtype">float</span> f = cellLineEdit-&gt;text().toFloat(&amp;ok);

    <span class="keywordflow">if</span> (ok)
      {
        dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModeli0">setItem</a>(row, col, f);
        <span class="keywordflow">return</span>;
      }


    dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModeli0">setItem</a>(row, col, cellLineEdit-&gt;text());
    }

}

<span class="keywordtype">void</span> Spreadsheet::selectFont(<span class="keywordtype">int</span> combo)
{
   Q_UNUSED(combo);

   QString family = fontFamilyCombo-&gt;currentText();
   QString size = fontSizeCombo-&gt;currentText();

    <span class="comment">// If cells are selected, set their display font</span>

    this-&gt;getSelectedRegion();

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
      QFontDatabase fdb;
      <span class="keywordtype">bool</span> ok;

      QFont currentFont = 
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(startSelectedRow, startSelectedColumn).<a class="code" href="classQicsCellCommon.html#QicsTableCommonz3_4">font</a>();

      QFont font = fdb.font(family, fdb.styleString(currentFont), 
                size.toInt(&amp;ok));

        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i,j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni42">setFont</a>(font);
    }

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  formatBackgroundColor</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Bring up the color dialog, select a color, apply it to the selected </span>
<span class="comment"> *    region as the background color</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::formatBackgroundColor()
{
    QColor color = QColorDialog::getColor();

    <span class="keywordflow">if</span> (! color.isValid())
    {
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// If cells are selected, set their display font</span>

    this-&gt;getSelectedRegion();

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i,j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni45">setBackgroundColor</a>(color);
    }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  formatForegroundColor</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Bring up the color dialog, select a color, apply it to the selected </span>
<span class="comment"> *    region as the foreground color</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::formatForegroundColor()
{
    QColor color = QColorDialog::getColor();

    <span class="keywordflow">if</span> (! color.isValid())
    {
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// If cells are selected, set their display font</span>

    this-&gt;getSelectedRegion();

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i,j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni44">setForegroundColor</a>(color);
    }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  formatFont</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Bring up the font dialog, select a font, apply it to the selected region</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::formatFont()
{
    <span class="keywordtype">bool</span> ok;

    <span class="comment">// Select a font</span>

    QFont font = QFontDialog::getFont(&amp;ok, QFont(<span class="stringliteral">"Helvetica"</span>, 10), <span class="keyword">this</span>);

    <span class="keywordflow">if</span> (!ok )
    {
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// If cells are selected, set their display font</span>

    this-&gt;getSelectedRegion();

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i,j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni42">setFont</a>(font);
    }

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  updateSelection</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    A cell was selected, so update the state of the toolbar pieces.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::updateSelection(<span class="keywordtype">bool</span> in_progress)
{
    <span class="keywordflow">if</span> (in_progress)
    {
    <span class="keywordflow">return</span>;
    }

    this-&gt;getSelectedRegion();

    <span class="comment">//qDebug("Cell selected: %d %d", startSelectedRow, startSelectedColumn);</span>

    <span class="keywordflow">if</span> ( (startSelectedRow &gt; -1 ) &amp;&amp; (startSelectedColumn &gt; -1) )
    {
        QFont font = table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(startSelectedRow, startSelectedColumn).<a class="code" href="classQicsCellCommon.html#QicsTableCommonz3_4">font</a>();
        setFontCombos(font);

        <span class="keywordflow">if</span> (font.bold())
        {
            fontBoldTB-&gt;setOn(<span class="keyword">true</span>);
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// Is on, turn off (not bold)</span>
            fontBoldTB-&gt;setOn(<span class="keyword">false</span>);
        }

        <span class="keywordflow">if</span> (font.italic())
        {
            fontItalicTB-&gt;setOn(<span class="keyword">true</span>);
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// Is on, turn off (not bold)</span>
            fontItalicTB-&gt;setOn(<span class="keyword">false</span>);
        }

        <span class="keywordflow">if</span> (font.underline())
        {
            fontUnderlineTB-&gt;setOn(<span class="keyword">true</span>);
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// Is on, turn off (not bold)</span>
            fontUnderlineTB-&gt;setOn(<span class="keyword">false</span>);
        }

        <span class="keywordtype">int</span> alignment = table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(startSelectedRow, startSelectedColumn).<a class="code" href="classQicsCellCommon.html#QicsTableCommonz3_13">alignment</a>();

        <span class="keywordflow">switch</span> (alignment)
        {

        <span class="keywordflow">case</span> Qt::AlignLeft:
            textLeftTB-&gt;setOn(<span class="keyword">true</span>);
            textRightTB-&gt;setOn(<span class="keyword">false</span>);
            textCenterTB-&gt;setOn(<span class="keyword">false</span>);
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> Qt::AlignRight:
            textLeftTB-&gt;setOn(<span class="keyword">false</span>);
            textRightTB-&gt;setOn(<span class="keyword">true</span>);
            textCenterTB-&gt;setOn(<span class="keyword">false</span>);
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> Qt::AlignHCenter:
            textLeftTB-&gt;setOn(<span class="keyword">false</span>);
            textRightTB-&gt;setOn(<span class="keyword">false</span>);
            textCenterTB-&gt;setOn(<span class="keyword">true</span>);
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> Qt::AlignAuto:
        <span class="keywordflow">default</span>:
            textLeftTB-&gt;setOn(<span class="keyword">false</span>);
            textRightTB-&gt;setOn(<span class="keyword">false</span>);
            textCenterTB-&gt;setOn(<span class="keyword">false</span>);
            <span class="keywordflow">break</span>;
        }

        <span class="keywordflow">if</span> (dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModela7">item</a>(startSelectedRow, startSelectedColumn) == NULL)
        {
            cellLineEdit-&gt;setText(<span class="stringliteral">""</span>);
            <span class="keywordflow">return</span>;
        }

        QicsCell* cell = table-&gt;<a class="code" href="classQicsTable.html#QicsTablea15">cell</a>(startSelectedRow, startSelectedColumn, <span class="keyword">true</span>);

        <span class="keywordflow">if</span> (cell-&gt;<a class="code" href="classQicsCell.html#QicsCella8">dataValue</a>())
        {
            QString cellval = cell-&gt;<a class="code" href="classQicsCell.html#QicsCella8">dataValue</a>()-&gt;<a class="code" href="classQicsDataItem.html#QicsDataItema4">string</a>();

            cellLineEdit-&gt;setText(cellval);
        }
    }

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  insertColumn</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Add a column to the table before the currently selected column</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::insertColumn()
{

    this-&gt;getSelectedRegion();

    <span class="keywordflow">if</span> (startSelectedColumn &gt; -1)
    {
        table-&gt;<a class="code" href="classQicsTable.html#QicsTablei85">insertColumn</a>(startSelectedColumn);
    }

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  insertRow</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Add a row to the table before the currently selected row</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::insertRow()
{

    this-&gt;getSelectedRegion();

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        table-&gt;<a class="code" href="classQicsTable.html#QicsTablei88">insertRow</a>(startSelectedRow);
    }

}


<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  setFontCombos</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Given a font, set the fontFamilyCombo to show it, set the fontSizeCombo</span>
<span class="comment"> *    to contain valid sizes for that font, and then show the correct</span>
<span class="comment"> *    font size.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::setFontCombos(<span class="keyword">const</span> QFont&amp; font)
{
    <span class="comment">// Set font family</span>
    fontFamilyCombo-&gt;setCurrentText(font.family());

    QFontDatabase fdb;
    QValueList&lt;int&gt; sizes = fdb.pointSizes(font.family());

    <span class="comment">// Clear the sizes combo, fill it with valid sizes based in family</span>

    fontSizeCombo-&gt;clear();

    <span class="keywordflow">if</span> (sizes.begin() != sizes.end())
      {
          <span class="keywordflow">for</span> (QValueList&lt;int&gt;::Iterator pts = sizes.begin(); pts != sizes.end(); ++pts)
          {
             fontSizeCombo-&gt;insertItem(QString::number(*pts));
          }
          fontSizeCombo-&gt;setCurrentText(QString::number(font.pointSize()));
     }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  textAlignLeft</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Set the alignment value of the displayed cell to AlignLeft</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::textAlignLeft()
{

    <span class="keywordflow">if</span> ( (startSelectedRow &lt; 0) &amp;&amp; (startSelectedColumn &lt; 0))
    {
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
            {
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni52">setAlignment</a>(Qt::AlignLeft);
            }
    }

    textRightTB-&gt;setOn(<span class="keyword">false</span>);
    textCenterTB-&gt;setOn(<span class="keyword">false</span>);

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  textAlignCenter</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Set the alignment value of the displayed cell to AlignHCenter</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::textAlignCenter()
{

    <span class="keywordflow">if</span> ( (startSelectedRow &lt; 0) &amp;&amp; (startSelectedColumn &lt; 0))
    {
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
            {
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni52">setAlignment</a>(Qt::AlignHCenter);
            }
    }

    textLeftTB-&gt;setOn(<span class="keyword">false</span>);
    textRightTB-&gt;setOn(<span class="keyword">false</span>);

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  textAlignRight</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Set the alignment value of the displayed cell to AlignRight</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::textAlignRight()
{

    <span class="keywordflow">if</span> ( (startSelectedRow &lt; 0) &amp;&amp; (startSelectedColumn &lt; 0))
    {
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
            {
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni52">setAlignment</a>(Qt::AlignRight);
            }
    }

    textLeftTB-&gt;setOn(<span class="keyword">false</span>);
    textCenterTB-&gt;setOn(<span class="keyword">false</span>);

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  textBold</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Toggle the boldness state of whatever cells are selected</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::textBold()
{

    <span class="keywordflow">if</span> ( (startSelectedRow &lt; 0) &amp;&amp; (startSelectedColumn &lt; 0))
    {
        <span class="keywordflow">return</span>;
    }

    <span class="keywordtype">bool</span> on = fontBoldTB-&gt;isOn();

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
            {
                QFont f = table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommonz3_4">font</a>();
                f.setBold(on);
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni42">setFont</a>(f);
            }
    }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  textItalic</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Toggle the italic-ness state of whatever cells are selected</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::textItalic()
{

    <span class="keywordflow">if</span> ( (startSelectedRow &lt; 0) &amp;&amp; (startSelectedColumn &lt; 0))
    {
        <span class="keywordflow">return</span>;
    }

    <span class="keywordtype">bool</span> on = fontItalicTB-&gt;isOn();

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
            {
                QFont f = table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommonz3_4">font</a>();
                f.setItalic(on);
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni42">setFont</a>(f);
            }
    }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  textUnderline</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Toggle the underline-ed-ness state of whatever cells are selected</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::textUnderline()
{

    <span class="keywordflow">if</span> ( (startSelectedRow &lt; 0) &amp;&amp; (startSelectedColumn &lt; 0))
    {
        <span class="keywordflow">return</span>;
    }

    <span class="keywordtype">bool</span> on = fontUnderlineTB-&gt;isOn();

    <span class="keywordflow">if</span> (startSelectedRow &gt; -1)
    {
        <span class="keywordtype">int</span> i, j;

        <span class="keywordflow">for</span> (i = startSelectedRow; i &lt; endSelectedRow; i++)
            <span class="keywordflow">for</span> (j = startSelectedColumn; j &lt; endSelectedColumn; j++)
            {
                QFont f = table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommonz3_4">font</a>();
                f.setUnderline(on);
                table-&gt;<a class="code" href="classQicsTable.html#QicsTablea13">cellRef</a>(i, j).<a class="code" href="classQicsCellCommon.html#QicsTableCommoni42">setFont</a>(f);
            }
    }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  openFile</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Protected slot, bring up a QFileDialog to select a file, then load it.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::openFile()
{
    QString fname = 
        QFileDialog::getOpenFileName();

    <span class="keywordflow">if</span> (fname != QString::null)
    {
        fileName = fname;
        loadFile(fileName);
    }

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  loadFile</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Load a Comma Delimited File into the data table</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::loadFile(QString fname)
{
    <span class="comment">// Create the stream from the file, read into data model</span>
    QFile file(fname);

    <span class="keywordflow">if</span> (file.open(IO_ReadOnly))
    {
        QTextStream stream(&amp;file);

        dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta16">readASCII</a>(stream, <span class="charliteral">','</span>);
    }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  saveFile</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Protected slot, save data to the current file name</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::saveFile()
{

    <span class="keywordflow">if</span> (fileName != QString::null)
    {
        writeFile(fileName);
    }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  saveFileAs</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *    Protected slot, bring up a QFileDialog to select a file, then save to it.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::saveFileAs()
{
    QString fname = 
        QFileDialog::getSaveFileName();

    <span class="keywordflow">if</span> (fname != QString::null)
    {
        fileName = fname;
        writeFile(fileName);
    }
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  writeFile</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Save a Comma Delimited File from the data table</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::writeFile(QString fname)
{

    <span class="comment">// Create the stream from the file, read into data model</span>
    QFile file(fname);

    <span class="keywordflow">if</span> (file.open(IO_WriteOnly))
    {
        QTextStream stream(&amp;file);

        dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta17">writeASCII</a>(stream, <span class="charliteral">','</span>, 0, 0, 10, 10);
    }

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  fileNew</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Clear out all the data currently displayed in the table.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::fileNew()
{
    <span class="comment">// To be implemented</span>
    qDebug(<span class="stringliteral">"To be implemented"</span>);
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  copy</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Calls the table's copy operation to place data into the QClipboard</span>
<span class="comment"> *     owned by qApp.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::copy()
{
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablei90">copy</a>();
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  cut</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Calls the table's cut operation to place data into the QClipboard</span>
<span class="comment"> *     owned by qApp and remove it from the visible table area</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::cut()
{
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablei89">cut</a>();
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  paste</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Calls the table's paste operation to retrieve cells from the QClipboard</span>
<span class="comment"> *     owned by qApp and paste them at the current cell.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::paste()
{
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablei91">paste</a>();
}


<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  getSelectedRegion</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Query the table, find the start and end row/column of the currently</span>
<span class="comment"> *     selected region, if any.</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::getSelectedRegion()
{
    <a class="code" href="classQicsSelection.html">QicsSelection</a> selection;
    <a class="code" href="classQicsSelectionList.html">QicsSelectionList</a> *list = table-&gt;<a class="code" href="classQicsTable.html#QicsTablea29">selectionList</a>();

    <span class="comment">// Get selected boundry</span>

    <span class="keywordflow">if</span> (list != NULL)
    {
        <span class="keywordflow">if</span> (list-&gt;begin() != list-&gt;end())
        {
            selection = *(list-&gt;begin());
    
            startSelectedRow = selection.<a class="code" href="classQicsSelection.html#QicsSelectiona12">anchorRow</a>();
            startSelectedColumn = selection.<a class="code" href="classQicsSelection.html#QicsSelectiona13">anchorColumn</a>();
        }
    }
    <span class="keywordflow">else</span>
    {
        startSelectedRow = startSelectedColumn = -1;  <span class="comment">// reset flags</span>
    }

    <span class="keyword">delete</span> list;

    <span class="keywordtype">int</span> row = selection.<a class="code" href="classQicsSelection.html#QicsSelectiona14">endRow</a>();
    <span class="keywordflow">if</span> (row &gt; dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta9">lastRow</a>())
        row = dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta9">lastRow</a>() + 1;
    <span class="keywordflow">else</span>
        row++;

    <span class="keywordtype">int</span> col = selection.<a class="code" href="classQicsSelection.html#QicsSelectiona15">endColumn</a>();
    <span class="keywordflow">if</span> (col &gt; dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta10">lastColumn</a>())
        col = dm-&gt;<a class="code" href="classQicsDataModel.html#QicsDataModelDefaulta10">lastColumn</a>() + 1;
    <span class="keywordflow">else</span>
        col++;

    endSelectedRow = row;
    endSelectedColumn = col;

}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  sortAscending</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Sort the table by the selected column in ascending order</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::sortAscending()
{
    getSelectedRegion();

    <span class="keywordtype">int</span> sort = (startSelectedColumn &gt; -1) ? startSelectedColumn : 0;
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea91">sortRows</a>(sort, Qics::Ascending);
}

<span class="comment">/*---------------------------------------------------------------------------</span>
<span class="comment"> *  Function:  sortDescending</span>
<span class="comment"> *</span>
<span class="comment"> *  Description:</span>
<span class="comment"> *     Sort the table by the selected column in descending order</span>
<span class="comment"> */</span>

<span class="keywordtype">void</span> Spreadsheet::sortDescending()
{
    getSelectedRegion();

    <span class="keywordtype">int</span> sort = (startSelectedColumn &gt; -1) ? startSelectedColumn : 0;
    table-&gt;<a class="code" href="classQicsTable.html#QicsTablea91">sortRows</a>(sort, Qics::Descending);
}

<span class="comment">/*---------------------------------------------------------------------------*/</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    QApplication qapp(argc, argv);

    Spreadsheet* ss = <span class="keyword">new</span> Spreadsheet(0, <span class="stringliteral">"SpreadsheetDemo"</span>);

    qapp.setMainWidget(ss);
    ss-&gt;show();

    QObject::connect(qApp, SIGNAL(lastWindowClosed()),
                     qApp, SLOT(quit()));
    <span class="keywordflow">return</span> qapp.exec();
}
</pre></div> <!-- footer -->
<P>
<center>
<font size="1">
All trademarks and copyrights on this page are properties of
their respective owners.<br> The rest is copyright 1999-2003 Integrated
Computer Solutions, Inc.
</font>
</center>
<!-- end footer -->
